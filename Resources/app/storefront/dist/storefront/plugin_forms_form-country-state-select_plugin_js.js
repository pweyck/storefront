"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["plugin_forms_form-country-state-select_plugin_js"],{6300:(t,e,n)=>{n.r(e),n.d(e,{default:()=>s});var r=n(9568),i=n(4049),o=n(3107);class s extends r.Z{init(){this.initClient(),this.initSelects()}initClient(){this._client=new o.Z}initSelects(){let{countrySelectSelector:t,countryStateSelectSelector:e,initialCountryAttribute:n,initialCountryStateAttribute:r}=s.options,o=i.Z.querySelector(this.el,t),a=i.Z.querySelector(this.el,e),u=i.Z.getDataAttribute(o,n),d=i.Z.getDataAttribute(a,r),l=o.options[o.selectedIndex],c=!!i.Z.getDataAttribute(l,this.options.vatIdRequired,!1),p=document.querySelector(this.options.vatIdFieldInput),h=!!i.Z.getDataAttribute(l,this.options.stateRequired,!1),q=i.Z.querySelector(document,this.options.zipcodeLabel,!1),b=i.Z.querySelector(document,this.options.zipcodeFieldInput,!1),_=!!i.Z.getDataAttribute(l,this.options.zipcodeRequired,!1);o.addEventListener("change",this.onChangeCountry.bind(this)),u&&(this.requestStateData(u,d,h),_&&this._updateZipcodeRequired(q,b,_),p&&this._updateRequiredVatId(p,c))}onChangeCountry(t){let e=t.target.value,n=t.target.options[t.target.selectedIndex],r=!!i.Z.getDataAttribute(n,this.options.stateRequired);this.requestStateData(e,null,r);let o=i.Z.getDataAttribute(n,this.options.vatIdRequired),s=document.querySelector(this.options.vatIdFieldInput),a=i.Z.querySelector(document,this.options.zipcodeLabel,!1),u=i.Z.querySelector(document,this.options.zipcodeFieldInput,!1),d=!!i.Z.getDataAttribute(n,this.options.zipcodeRequired,!1);this._updateZipcodeRequired(a,u,d),s&&this._updateRequiredVatId(s,o)}requestStateData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=JSON.stringify({countryId:t});this._client.post(window.router["frontend.country.country-data"],r,t=>{let r=JSON.parse(t);!function(t,e,n,r){let{stateRequired:o,states:s}=t,{countryStateSelectSelector:a,countryStatePlaceholderSelector:u}=r,d=i.Z.querySelector(n,a);(function(t,e){t.querySelectorAll(e).forEach(t=>t.remove())})(d,"option:not(".concat(u,")")),function(t,e,n){if(0===e.length){t.parentNode.classList.add("d-none"),t.setAttribute("disabled","disabled");return}e.map(t=>(function(t,e){let n=document.createElement("option");return n.setAttribute("value",t.id),n.innerText=t.translated.name,t.id===e&&n.setAttribute("selected","selected"),n})(t,n)).forEach(e=>{t.append(e)}),t.parentNode.classList.remove("d-none"),t.removeAttribute("disabled")}(d,s,e),function(t,e,n){let r=t.querySelector(n),i=t.parentNode.querySelector("label");if(e){r.setAttribute("disabled","disabled"),t.setAttribute("required","required"),i.textContent&&"*"!==i.textContent.substr(-1,1)&&(i.textContent="".concat(i.textContent.trim(),"*"));return}i.textContent&&"*"===i.textContent.substr(-1,1)&&(i.textContent=i.textContent.substr(0,i.textContent.length-1)),r.removeAttribute("disabled"),t.removeAttribute("required")}(d,o,"option".concat(u))}(r={...r,stateRequired:n},e,this.el,s.options)})}_updateRequiredVatId(t,e){let n=t.parentNode.querySelector("label");if(e){t.setAttribute("required","required"),"*"!==n.textContent.substr(-1,1)&&(n.textContent="".concat(n.textContent,"*"));return}"*"===n.textContent.substr(-1,1)&&(n.textContent=n.textContent.substr(0,n.textContent.length-1)),t.removeAttribute("required")}_updateZipcodeRequired(t,e,n){if(t&&e){if(t.className=n?"":"d-none",n){e.setAttribute("required","required");return}e.removeAttribute("required")}}}s.options={countrySelectSelector:".country-select",initialCountryAttribute:"initial-country-id",countryStateSelectSelector:".country-state-select",initialCountryStateAttribute:"initial-country-state-id",countryStatePlaceholderSelector:'[data-placeholder-option="true"]',vatIdFieldInput:"#vatIds",zipcodeFieldInput:'[data-input-name="zipcodeInput"]',vatIdRequired:"vat-id-required",stateRequired:"state-required",zipcodeRequired:"zipcode-required",zipcodeLabel:"#zipcodeLabel"}},3107:(t,e,n)=>{n.d(e,{Z:()=>r});class r{get(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",r=this._createPreparedRequest("GET",t,n);return this._sendRequest(r,null,e)}post(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(e,r);let i=this._createPreparedRequest("POST",t,r);return this._sendRequest(i,e,n)}delete(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(e,r);let i=this._createPreparedRequest("DELETE",t,r);return this._sendRequest(i,e,n)}patch(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(e,r);let i=this._createPreparedRequest("PATCH",t,r);return this._sendRequest(i,e,n)}abort(){if(this._request)return this._request.abort()}setErrorHandlingInternal(t){this._errorHandlingInternal=t}_registerOnLoaded(t,e){e&&(!0===this._errorHandlingInternal?(t.addEventListener("load",()=>{e(t.responseText,t)}),t.addEventListener("abort",()=>{console.warn("the request to ".concat(t.responseURL," was aborted"))}),t.addEventListener("error",()=>{console.warn("the request to ".concat(t.responseURL," failed with status ").concat(t.status))}),t.addEventListener("timeout",()=>{console.warn("the request to ".concat(t.responseURL," timed out"))})):t.addEventListener("loadend",()=>{e(t.responseText,t)}))}_sendRequest(t,e,n){return this._registerOnLoaded(t,n),t.send(e),t}_getContentType(t,e){return t instanceof FormData&&(e=!1),e}_createPreparedRequest(t,e,n){return this._request=new XMLHttpRequest,this._request.open(t,e),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),n&&this._request.setRequestHeader("Content-type",n),this._request}constructor(){this._request=null,this._errorHandlingInternal=!1}}}}]);